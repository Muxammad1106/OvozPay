# AI –ú–æ–¥—É–ª—å OvozPay

–ú–æ–¥—É–ª—å –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º OCR (—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤) –∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### OCR (–û–ø—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤)
- **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —á–µ–∫–æ–≤** –Ω–∞ —Ä—É—Å—Å–∫–æ–º, —É–∑–±–µ–∫—Å–∫–æ–º –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–∞—Ö
- **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**: –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞, —Å—É–º–º–∞, —Ç–æ–≤–∞—Ä—ã, –¥–∞—Ç–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è** —Ç–æ–≤–∞—Ä–æ–≤ –∏ —Ç—Ä–∞—Ç
- **–ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è

### –ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏** —Å –ø–æ–º–æ—â—å—é Whisper.cpp
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã**: —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ç, –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å**: —Ä—É—Å—Å–∫–∏–π, —É–∑–±–µ–∫—Å–∫–∏–π, –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥** —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥–µ–π—Å—Ç–≤–∏–π

### NLP –∏ –∞–Ω–∞–ª–∏–∑
- **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π** –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- **–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–∞** –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥** –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

#### macOS (Homebrew)
```bash
# Tesseract OCR
brew install tesseract tesseract-lang

# FFmpeg –¥–ª—è –∞—É–¥–∏–æ
brew install ffmpeg

# Whisper.cpp (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
git clone https://github.com/ggerganov/whisper.cpp.git
cd whisper.cpp
make
```

#### Ubuntu/Debian
```bash
# Tesseract OCR
sudo apt-get install tesseract-ocr tesseract-ocr-rus tesseract-ocr-eng

# FFmpeg
sudo apt-get install ffmpeg

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
sudo apt-get install libsndfile1 portaudio19-dev
```

### 2. Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ AI –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements-ai.txt

# –ò–ª–∏ –ø–æ—ç—Ç–∞–ø–Ω–æ:
pip install pytesseract Pillow opencv-python
pip install pydub librosa soundfile
pip install nltk textdistance langdetect
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–µ–π

#### Tesseract —è–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤
tesseract --list-langs

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# –î–ª—è —É–∑–±–µ–∫—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
```

#### Whisper –º–æ–¥–µ–ª–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–µ–π
mkdir -p models/whisper

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π (–ø—Ä–∏–º–µ—Ä—ã)
wget https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-small.bin -O models/whisper/ggml-small.bin
wget https://huggingface.co/ggerganov/whisper.cpp/resolve/main/ggml-base.bin -O models/whisper/ggml-base.bin
```

## üìä API Endpoints

### OCR Endpoints
```
GET    /api/ai/ocr/                    # –°–ø–∏—Å–æ–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ OCR
POST   /api/ai/ocr/                    # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
GET    /api/ai/ocr/{id}/               # –î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ OCR
POST   /api/ai/ocr/{id}/reprocess/     # –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
POST   /api/ai/ocr/bulk_process/       # –ú–∞—Å—Å–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
GET    /api/ai/ocr/statistics/         # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ OCR
```

### Voice Endpoints
```
GET    /api/ai/voice/                  # –°–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
POST   /api/ai/voice/                  # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ
GET    /api/ai/voice/{id}/             # –î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
POST   /api/ai/voice/{id}/reprocess/   # –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
```

### Command Endpoints
```
GET    /api/ai/commands/               # –°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥
POST   /api/ai/commands/               # –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
POST   /api/ai/commands/{id}/execute/  # –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã
```

### Service Endpoints
```
GET    /api/ai/service/status/         # –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
GET    /api/ai/service/commands/       # –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã
POST   /api/ai/service/match_receipt/  # –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —á–µ–∫–∞ –∏ –≥–æ–ª–æ—Å–∞
```

## üé§ –ì–æ–ª–æ—Å–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- "–°–æ–∑–¥–∞–π –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø—Ä–æ–¥—É–∫—Ç—ã"
- "–î–æ–±–∞–≤—å –Ω–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç"

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞—Ç
- "–î–æ–±–∞–≤—å —Ç—Ä–∞—Ç—É 5000 —Å—É–º –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç—ã"
- "–ó–∞–ø–∏—à–∏ —Ä–∞—Å—Ö–æ–¥ 100 –¥–æ–ª–ª–∞—Ä–æ–≤ –Ω–∞ —Ç–∞–∫—Å–∏"

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- "–ü–æ–∫–∞–∂–∏ –º–æ–π –±–∞–ª–∞–Ω—Å"
- "–°–∫–æ–ª—å–∫–æ —É –º–µ–Ω—è –¥–µ–Ω–µ–≥?"

#### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ª–≥–∞–º–∏
- "–î–æ–±–∞–≤—å –¥–æ–ª–≥ –ê—Ö–º–∞–¥—É 50000 —Å—É–º"
- "–í–µ—Ä–Ω–∏ –¥–æ–ª–≥ –§–∞—Ä–∏–¥–µ"

#### –£–¥–∞–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- "–£–¥–∞–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—é —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è"

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Django
```python
# settings.py

# Tesseract –ø—É—Ç—å (–µ—Å–ª–∏ –Ω–µ –≤ PATH)
TESSERACT_CMD = '/usr/local/bin/tesseract'  # macOS Homebrew
# TESSERACT_CMD = '/usr/bin/tesseract'      # Linux

# Whisper –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
WHISPER_MODEL_PATH = 'models/whisper/ggml-small.bin'
WHISPER_EXECUTABLE = '/path/to/whisper/main'

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏
AI_SUPPORTED_LANGUAGES = ['ru', 'uz', 'en']

# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤
MAX_IMAGE_SIZE = 10 * 1024 * 1024  # 10MB
MAX_AUDIO_SIZE = 25 * 1024 * 1024  # 25MB
```

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### OCR –æ–±—Ä–∞–±–æ—Ç–∫–∞
```python
from apps.ai.services.ocr.tesseract_service import TesseractOCRService
from django.core.files.uploadedfile import SimpleUploadedFile

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
ocr_service = TesseractOCRService()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
with open('receipt.jpg', 'rb') as f:
    image_file = SimpleUploadedFile('receipt.jpg', f.read())
    result = ocr_service.process_receipt_image(user, image_file)

print(f"–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: {result.recognized_text}")
print(f"–ú–∞–≥–∞–∑–∏–Ω: {result.shop_name}")
print(f"–°—É–º–º–∞: {result.total_amount}")
```

### –ì–æ–ª–æ—Å–æ–≤–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ
```python
from apps.ai.services.voice.whisper_service import WhisperVoiceService

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞
voice_service = WhisperVoiceService()

# –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
with open('voice_command.mp3', 'rb') as f:
    audio_file = SimpleUploadedFile('command.mp3', f.read())
    result = voice_service.process_voice_message(user, audio_file, 'voice_command')

print(f"–†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç: {result.recognized_text}")
print(f"–Ø–∑—ã–∫: {result.language_detected}")
```

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
```python
from apps.ai.models import AIProcessingLog

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
recent_logs = AIProcessingLog.objects.filter(
    user=user,
    operation_type='ocr_processing'
).order_by('-created_at')[:10]

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
user_stats = AIProcessingLog.objects.filter(user=user).values(
    'operation_type'
).annotate(count=models.Count('id'))
```

### Django Admin
- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ `/admin/ai/` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Tesseract** –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —É–∑–±–µ–∫—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
2. **Whisper.cpp** —Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤
3. **–ë–æ–ª—å—à–∏–µ –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã** (>5 –º–∏–Ω—É—Ç) –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è –º–µ–¥–ª–µ–Ω–Ω–æ
4. **–ö–∞—á–µ—Å—Ç–≤–æ OCR** –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ–∫–∞

## üõ† –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
python manage.py test apps.ai
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
python manage.py shell
>>> from apps.ai.services.ocr.tesseract_service import TesseractOCRService
>>> service = TesseractOCRService()
>>> service.get_processing_status()
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø—É—Ç–µ–π –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–∞–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ Django Admin
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Tesseract –∏ Whisper.cpp 